{% extends "base.html" %}

{% block title %}Explore Peers - SunDevil Circle{% endblock %}

{% block content %}
<div class="container" style="padding-top: 180px; padding-bottom: 80px;">

    <div style="margin-bottom: 40px;">
        <h1 style="font-size: 32px; font-weight: 700; color: var(--text-primary);">Explore Peer Supporters üë•</h1>
        <p style="color: var(--text-secondary); margin-top: 8px; font-size: 18px;">Connect with trained peers who
            understand your experiences.</p>
    </div>

    <!-- Filter Section -->
    <div class="card" style="margin-bottom: 32px;">
        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px;">Filter by Challenge</h3>
        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
            <a href="{{ url_for('people') }}" class="group-tag-btn"
                style="{{ 'background: var(--primary-maroon); color: white;' if not filter else '' }}">All</a>
            <a href="{{ url_for('people', filter='homesickness') }}" class="group-tag-btn"
                style="{{ 'background: var(--primary-maroon); color: white;' if filter == 'homesickness' else '' }}">üè†
                Homesickness</a>
            <a href="{{ url_for('people', filter='academic') }}" class="group-tag-btn"
                style="{{ 'background: var(--primary-maroon); color: white;' if filter == 'academic' else '' }}">üìö
                Academic</a>
            <a href="{{ url_for('people', filter='social') }}" class="group-tag-btn"
                style="{{ 'background: var(--primary-maroon); color: white;' if filter == 'social' else '' }}">üë•
                Social</a>
            <a href="{{ url_for('people', filter='cultural') }}" class="group-tag-btn"
                style="{{ 'background: var(--primary-maroon); color: white;' if filter == 'cultural' else '' }}">üåç
                Cultural</a>
            <a href="{{ url_for('people', filter='language') }}" class="group-tag-btn"
                style="{{ 'background: var(--primary-maroon); color: white;' if filter == 'language' else '' }}">üí¨
                Language</a>
        </div>
    </div>

    <!-- Peers Grid -->
    {% if peers %}
    <div class="steps-grid">
        {% for peer in peers %}
        <div class="step-card">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                <div
                    style="width: 48px; height: 48px; background: linear-gradient(135deg, #8B1538, #A91D3A); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; font-weight: 600;">
                    {{ peer.display_name[0].upper() if peer.display_name else '?' }}
                </div>
                <div>
                    <h3 style="font-size: 18px; font-weight: 600; color: var(--text-primary);">{{ peer.display_name }}
                    </h3>
                    {% if peer.is_international_freshman %}
                    <span
                        style="font-size: 12px; background: var(--pink-light); color: var(--primary-maroon); padding: 2px 8px; border-radius: 12px;">International
                        Freshman</span>
                    {% endif %}
                </div>
            </div>

            {% if peer.preferred_language %}
            <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">
                üåê Speaks {{ peer.preferred_language }}
            </p>
            {% endif %}

            {% if peer.primary_challenge %}
            <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 12px;">
                {% for challenge in peer.primary_challenge.split(',')[:3] %}
                <span
                    style="font-size: 12px; background: #F3F4F6; color: var(--text-secondary); padding: 4px 10px; border-radius: 12px;">
                    {{ challenge.strip() }}
                </span>
                {% endfor %}
            </div>
            {% endif %}

            <button onclick="connectWithPeer('{{ peer.display_name }}')" class="btn btn-outline"
                style="width: 100%; margin-top: 16px;">
                Connect
            </button>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card text-center" style="padding: 60px 20px;">
        <p style="font-size: 48px; margin-bottom: 16px;">üë•</p>
        <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 8px;">No peers found</h3>
        <p style="color: var(--text-secondary);">Try adjusting your filters or check back later.</p>
    </div>
    {% endif %}

    <!-- Back to Dashboard -->
    <div style="margin-top: 40px;">
        <a href="{{ url_for('decision') }}" class="btn btn-outline">‚Üê Back to Dashboard</a>
    </div>
</div>

<!-- Connect Modal -->
<div id="connectModal" class="modal" style="display: none;">
    <div class="modal-content">
        <h3>Connect with Peer</h3>
        <p id="connectMessage">Would you like to send a connection request?</p>
        <div class="modal-actions">
            <button onclick="sendConnection()" class="btn btn-maroon">Send Request</button>
            <button onclick="closeConnectModal()" class="btn btn-secondary">Cancel</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    let selectedPeer = '';

    function connectWithPeer(peerName) {
        selectedPeer = peerName;
        document.getElementById('connectMessage').textContent = 'Would you like to connect with ' + peerName + '?';
        document.getElementById('connectModal').style.display = 'flex';
    }

    function closeConnectModal() {
        document.getElementById('connectModal').style.display = 'none';
    }

    function sendConnection() {
        // In a real app, this would send a connection request
        alert('Connection request sent to ' + selectedPeer + '! (This is a demo)');
        closeConnectModal();
    }

    document.getElementById('connectModal')?.addEventListener('click', function (e) {
        if (e.target === this) {
            closeConnectModal();
        }
    });
</script>
{% endblock %}